<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #clicker { 
            width: 200px; height: 200px; background: #007BFF; 
            border-radius: 50%; margin: 30px auto; display: flex;
            align-items: center; justify-content: center; 
            color: white; font-size: 24px; cursor: pointer;
            transition: transform 0.1s;
        }
        #clicker:active { transform: scale(0.95); }
        .stats { margin: 20px 0; font-size: 18px; }
    </style>
</head>
<body>
    <h1>Telegram Clicker</h1>
    <div id="user-greeting">Загрузка...</div>
    
    <div class="stats">
        <div>Кликов: <span id="clicks">0</span></div>
        <div>Уровень: <span id="level">1</span></div>
    </div>
    
    <div id="clicker">КЛИК!</div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Получаем auth-параметры из URL
        const urlParams = new URLSearchParams(window.location.search);
        const authData = urlParams.get('auth');
        
        // Игровые данные
        let gameData = {
            auth: authData,
            clicks: 0,
            level: 1
        };
        
        // Элементы интерфейса
        const clicker = document.getElementById('clicker');
        const clicksDisplay = document.getElementById('clicks');
        const levelDisplay = document.getElementById('level');
        const greeting = document.getElementById('user-greeting');
        
        // Автозагрузка данных при открытии
        function initApp() {
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                greeting.innerHTML = `Привет, <b>${user.first_name}</b>!`;
                
                // Здесь должен быть запрос к вашему API для загрузки сохраненных данных
                // Для примера используем локальные данные
                if (authData) {
                    gameData.clicks = 100; // Пример: загружаем сохраненные данные
                    gameData.level = 5;    // В реальности - с сервера
                    updateUI();
                }
            }
        }
        
        // Обработчик кликов
        clicker.addEventListener('click', () => {
            gameData.clicks++;
            if (gameData.clicks % 10 === 0) gameData.level++;
            updateUI();
            
            // Автосохранение каждые 5 кликов
            if (gameData.clicks % 5 === 0) {
                tg.sendData(JSON.stringify(gameData));
            }
        });
        
        // Обновление интерфейса
        function updateUI() {
            clicksDisplay.textContent = gameData.clicks;
            levelDisplay.textContent = gameData.level;
        }
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Автосохранение при закрытии
        tg.onEvent('viewportChanged', () => {
            if (!tg.isExpanded) {
                tg.sendData(JSON.stringify(gameData));
            }
        });
    </script>
</body>
</html>
